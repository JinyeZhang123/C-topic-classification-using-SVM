   if (val >= (1 << n)) n = 0;
    }              