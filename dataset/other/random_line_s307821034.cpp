  for (int ty = max(1, y - 3); ty <= min(8, y + 3); ++ty) {
